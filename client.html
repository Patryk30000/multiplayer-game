<!DOCTYPE html>
<html>
<head>
    <title>Multiplayer Game + Chat</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        body { backgrond-color: blue; font-family: comic-neue; cursive; font-weight: 400; font-style: normal; display: flex; }
        #chat { width: 300px; margin-left: 10px; }
        #messages { height: 500px; border: 1px solid #ccc; overflow-y: auto; padding: 5px; }
        canvas { border:1px solid black; }
    </style>
</head>
<body>

<canvas id="game" width="800" height="600"></canvas>

<div id="chat">
    <div id="messages"></div>
    <input id="name" placeholder="Name" />
    <input id="input" placeholder="Type message..." />
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const socket = io();

let myId = null;
let players = {};

socket.on("init", data => {
    myId = data.id;
    players = data.players;
});

socket.on("update", data => {
    players = data;
    draw();
});

socket.on("chat", data => addMessage(`<b>${data.name}:</b> ${data.message}`));
socket.on("system", msg => addMessage(`<i>${msg}</i>`));

document.addEventListener("keydown", e => {
    let move = { dx:0, dy:0, id:myId };
    if (e.key === "ArrowUp") move.dy = -5;
    if (e.key === "ArrowDown") move.dy = 5;
    if (e.key === "ArrowLeft") move.dx = -5;
    if (e.key === "ArrowRight") move.dx = 5;
    socket.emit("move", move);
});

document.getElementById("input").addEventListener("keydown", e => {
    if (e.key === "Enter") {
        const name = document.getElementById("name").value || "Player";
        const msg = e.target.value;
        if (msg.trim()) {
            socket.emit("chat", { name, message: msg });
            e.target.value = "";
        }
    }
});

function addMessage(html) {
    const div = document.createElement("div");
    div.innerHTML = html;
    const messages = document.getElementById("messages");
    messages.appendChild(div);
    messages.scrollTop = messages.scrollHeight;
}

function draw() {
    // Gray background
    ctx.fillStyle = "#808080"; // gray
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Draw players
    for (let id in players) {
        ctx.beginPath();
        ctx.arc(players[id].x, players[id].y, 10, 0, Math.PI * 2);
        ctx.fillStyle = id === myId ? "red" : "blue";
        ctx.fill();
    }
}
</script>

</body>
</html>




